<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ByteAlchemy â€” Login / Signup</title>
    <style>
      :root {
        --bg: #050912;
        --card: rgba(255, 255, 255, 0.04);
        --glass: rgba(255, 255, 255, 0.06);
        --accent: #22d3ee;
        --accent-dark: #34d399;
        --accent-alt: #8b5cf6;
        --text: #e6eef6;
        --muted: #9aa4b2;
        --navbar-height: 72px;
      }

      /* GLOBAL */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
          "Helvetica Neue", Arial;
        background: radial-gradient(
          circle at 10% 10%,
          #071025 0%,
          #050912 50%,
          #030612 100%
        );
        color: var(--text);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        overflow-x: hidden;
      }

      /* FADE-IN */
      .fade-in {
        opacity: 0;
        transform: translateY(14px);
        transition: opacity 0.6s ease, transform 0.6s ease;
      }
      .fade-in.visible {
        opacity: 1;
        transform: none;
      }

      /* CARD */
      .card {
        width: 100%;
        max-width: 400px;
        background: var(--glass);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.04);
        text-align: center;
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      /* LOGO */
      .logo {
        width: 88px;
        height: 88px;
        border-radius: 20px;
        background: linear-gradient(135deg, var(--accent), var(--accent-alt));
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 800;
        color: #041015;
        font-size: 28px;
        margin: 0 auto;
        box-shadow: 0 6px 30px rgba(139, 92, 246, 0.35);
        animation: logoGlow 3s ease-in-out infinite alternate;
      }
      @keyframes logoGlow {
        from {
          box-shadow: 0 6px 18px rgba(139, 92, 246, 0.25);
        }
        to {
          box-shadow: 0 10px 40px rgba(139, 92, 246, 0.9);
        }
      }

      /* HEADINGS */
      h1 {
        font-size: 1.8rem;
        color: var(--accent);
      }
      .lead {
        font-size: 13px;
        color: var(--muted);
      }

      /* INPUTS */
      input {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        background: rgba(0, 0, 0, 0.25);
        color: var(--text);
        font-size: 16px;
        outline: none;
      }
      input:focus {
        box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.08);
        border-color: var(--accent);
      }

      /* BUTTONS */
      button {
        width: 100%;
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        font-weight: 700;
        background: linear-gradient(90deg, var(--accent), var(--accent-alt));
        color: #041015;
        cursor: pointer;
        transition: transform 0.15s ease;
      }
      button:hover {
        transform: translateY(-3px);
      }

      /* LINKS / MESSAGES */
      .toggle-link {
        font-size: 13px;
        color: var(--accent);
        cursor: pointer;
      }
      .toggle-link:hover {
        color: var(--accent-dark);
        text-decoration: underline;
      }
      .message {
        font-size: 13px;
        color: var(--muted);
      }

      /* RESPONSIVE */
      @media (max-width: 480px) {
        .logo {
          width: 78px;
          height: 78px;
          font-size: 22px;
        }
        .card {
          padding: 16px;
        }
      }
    </style>
  </head>
  <body>
    <div class="card fade-in" id="authCard">
      <div class="logo">BA</div>
      <h1 id="formTitle">ByteAlchemy Login</h1>
      <div class="lead" id="formLead">
        Lerne, chatte und wachse â€“ beginne hier.
      </div>
      <input
        id="username"
        type="text"
        placeholder="Benutzername"
        style="display: none"
      />
      <input id="email" type="email" placeholder="Email" />
      <input id="password" type="password" placeholder="Passwort" />
      <button id="submitBtn" onclick="signin()">Sign In</button>
      <div class="toggle-link" id="toggleLink" onclick="toggleMode()">
        Noch kein Account? Jetzt registrieren
      </div>
      <div class="toggle-link" onclick="resetPassword()">
        <a
          href="reset.html"
          style="color: var(--accent); text-decoration: none"
        >
          Passwort vergessen?
        </a>
      </div>
      <div
        class="toggle-link hidden"
        id="resendLink"
        onclick="resendVerification()"
      >
        Verifikationsmail erneut senden
      </div>
      <div class="message" id="message"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyCUUJ-Cjx2fS3d4z4BGy_wYMvg91HSUd08",
        authDomain: "bytealchemy-2ba0b.firebaseapp.com",
        projectId: "bytealchemy-2ba0b",
      };
      firebase.initializeApp(firebaseConfig);
      const auth = firebase.auth();
      const db = firebase.firestore();

      const authCard = document.getElementById("authCard");
      const msg = document.getElementById("message");
      const usernameInput = document.getElementById("username");
      const formTitle = document.getElementById("formTitle");
      const formLead = document.getElementById("formLead");
      const submitBtn = document.getElementById("submitBtn");
      const toggleLink = document.getElementById("toggleLink");
      const resendLink = document.getElementById("resendLink");

      let isSignupMode = false;

      function toggleMode() {
        isSignupMode = !isSignupMode;
        if (isSignupMode) {
          formTitle.textContent = "ByteAlchemy Registrierung";
          formLead.textContent =
            "Erstelle deinen Account und wÃ¤hle deinen Benutzernamen.";
          usernameInput.style.display = "block";
          submitBtn.textContent = "Sign Up";
          submitBtn.onclick = signup;
          toggleLink.textContent = "Schon registriert? Zum Login";
        } else {
          formTitle.textContent = "ByteAlchemy Login";
          formLead.textContent = "Lerne, chatte und wachse â€“ beginne hier.";
          usernameInput.style.display = "none";
          submitBtn.textContent = "Sign In";
          submitBtn.onclick = signin;
          toggleLink.textContent = "Noch kein Account? Jetzt registrieren";
        }
        msg.textContent = "";
        resendLink.classList.add("hidden");
      }

      // Auth Listener
      auth.onAuthStateChanged(async (user) => {
        if (user) {
          await user.reload();
          if (user.emailVerified) {
            msg.textContent = "âœ… E-Mail bestÃ¤tigt! Weiterleitung...";
            setTimeout(() => (window.location.href = "main.html"), 1500);
          } else {
            msg.textContent = "âš ï¸ Bitte bestÃ¤tige zuerst deine E-Mail-Adresse!";
            resendLink.classList.remove("hidden");
            await auth.signOut();
          }
        }
      });

      // SIGNUP
      async function signup() {
        const email = document.getElementById("email").value;
        const pw = document.getElementById("password").value;
        const username = document.getElementById("username").value;
        try {
          if (!username) throw new Error("Bitte gib einen Benutzernamen ein!");
          const userCredential = await auth.createUserWithEmailAndPassword(
            email,
            pw
          );
          const user = userCredential.user;
          await db.collection("users").doc(user.uid).set({
            email: user.email,
            username: username,
            createdAt: new Date(),
          });
          await user.sendEmailVerification({
            url: window.location.href,
            handleCodeInApp: true,
          });
          msg.textContent = `âœ… Willkommen, ${username}! Bitte Ã¼berprÃ¼fe deine E-Mail fÃ¼r die Verifikation.`;
          resendLink.classList.remove("hidden");
        } catch (e) {
          msg.textContent = "âŒ " + e.message;
        }
      }

      // SIGNIN
      async function signin() {
        const email = document.getElementById("email").value;
        const pw = document.getElementById("password").value;
        try {
          const userCredential = await auth.signInWithEmailAndPassword(
            email,
            pw
          );
          const user = userCredential.user;
          await user.reload();
          if (!user.emailVerified) {
            msg.textContent = "âš ï¸ Bitte bestÃ¤tige zuerst deine E-Mail-Adresse!";
            resendLink.classList.remove("hidden");
            await auth.signOut();
            return;
          }
          msg.textContent = "âœ… Login erfolgreich! Weiterleitung...";
          setTimeout(() => (window.location.href = "main.html"), 1000);
        } catch (e) {
          msg.textContent = "âŒ " + e.message;
        }
      }

      // PASSWORT ZURÃœCKSETZEN
      async function resetPassword() {
        const email = document.getElementById("email").value;
        if (!email) return alert("Bitte gib deine E-Mail ein!");
        try {
          await auth.sendPasswordResetEmail(email, {
            url: window.location.href,
          });
          alert("Eine E-Mail zum ZurÃ¼cksetzen des Passworts wurde verschickt!");
        } catch (e) {
          alert(e.message);
        }
      }

      // VERIFIKATIONSMAIL ERNEUT SENDEN
      async function resendVerification() {
        const email = document.getElementById("email").value;
        const pw = document.getElementById("password").value;
        if (!email || !pw) {
          msg.textContent =
            "Bitte gib zuerst deine E-Mail und dein Passwort ein.";
          return;
        }
        try {
          const userCredential = await auth.signInWithEmailAndPassword(
            email,
            pw
          );
          const user = userCredential.user;
          if (user.emailVerified) {
            msg.textContent = "âœ… Deine E-Mail ist bereits verifiziert!";
            return;
          }
          await user.sendEmailVerification({
            url: window.location.href,
            handleCodeInApp: true,
          });
          msg.textContent = "ðŸ“§ Verifikationsmail wurde erneut gesendet!";
          await auth.signOut();
        } catch (e) {
          msg.textContent = "âŒ " + e.message;
        }
      }

      // Fade-in observer
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((e) => {
            if (e.isIntersecting) e.target.classList.add("visible");
          });
        },
        { threshold: 0.12 }
      );
      document
        .querySelectorAll(".fade-in")
        .forEach((el) => observer.observe(el));
    </script>
  </body>
</html>
